<app-box [Title]="'Metrics'">
  <app-form-element-group [LabelText]="'Dashboard Configuration'">
    <div class="flex align-items-baseline gap-1rem">
      <app-form-element [Type]="'select'" [LabelText]="'Available Graphs'" [(Model)]="graphToAdd" [SelectList]="graphs"
        [DisplayProperty]="'name'" [DisplayEmptyOption]="true" [MinWidth]="'200px'"></app-form-element>
      <app-button [ButtonType]="'add'" (FunctionCallBack)="addGraphToDashboard()"></app-button>
    </div>
    <app-form-element [Type]="'select'" [LabelText]="'Team'" [(Model)]="dashboard.active_team.team_id"
      [SelectList]="teams" [DisplayProperty]="'team_no'" [DisplayProperty2]="'team_nm'" [BindingProperty]="'team_no'"
      [DisplayEmptyOption]="true"></app-form-element>

    <app-form-element [Type]="'select'" [LabelText]="'Reference Team'"
      [(Model)]="dashboard.active_team.reference_team_id" [SelectList]="teams" [DisplayProperty]="'team_no'"
      [DisplayProperty2]="'team_nm'" [BindingProperty]="'team_no'" [DisplayEmptyOption]="true"></app-form-element>

    <app-button-ribbon>
      <app-button [ButtonType]="'success'" (FunctionCallBack)="saveDashboard()">Save</app-button>
    </app-button-ribbon>
  </app-form-element-group>

  @for (dashboard_graph of dashboard.dashboard_graphs; track $index) {
  <div>
    <app-chart [ChartTitle]="dashboard_graph.graph_name" [ChartType]="dashboard_graph.graph_typ"
      [Data]="dashboard_graph.data"></app-chart>
  </div>
  }
</app-box>


<app-form-element-group>
  <app-form-element [Type]="'select'" [LabelText]="'Result'" [SelectList]="fieldResponses"
    [DisplayProperty]="'display_value'" [Model]="fieldResponse"
    (ModelChange)="setFieldResponse($event)"></app-form-element>
</app-form-element-group>

@if (fieldForm && fieldForm.img_url) {
<div class="margin-top-1rem">
  <div #imageBackground id="image-background" class="flex align-items-center justify-content-center">
    <div #imageContainer id="image-container">
      <img #image id="image" [src]="false ? fieldForm.inv_img_url : fieldForm.img_url" />
      @if (fieldResponse) { @for (answer of fieldResponse.answers; track $index)
      { @if (answer.flow_answers) { @for (flow_answer of answer.flow_answers;
      track $index) { @if (flow_answer.question) {
      <div #box class="box" [ngStyle]="{
          top: flow_answer.question.y + '%',
          left: flow_answer.question.x + '%',
          width: flow_answer.question.width + '%',
          height: flow_answer.question.height + '%'
        }">
        <div class="touchpoint-wrapper">
          @if (flow_answer.value.x && flow_answer.value.y) {
          <!--
          <div
            #box
            class="box"
            [ngStyle]="{
              top: 'calc(' + qfa.answer.y + '% - 5px)',
              left: 'calc(' + qfa.answer.x + '% - 5px)',
              width: '10px',
              height: '10px'
            }"
          ></div>
          -->
          <div #box class="box" [ngStyle]="{
              top: 'calc(' + flow_answer.value.y + '% - 4px)',
              left: 'calc(' + flow_answer.value.x + '% - 4px)',
              width: '8px',
              height: '8px',
              border: '4px solid orange'
            }"></div>
          <!--<app-display-question-svg
            [Inverted]="false"
            [Question]="flow_answer.question"
          ></app-display-question-svg>-->
          } @else {
          <p>{{ flow_answer.value }}</p>
          }
          <div class="label">
            @if ( flow_answer.question.icon) {
            <span class="mdi icon mdi-{{ flow_answer.question.icon }}"></span>
            }
            <p>{{ flow_answer.question.question }}</p>
          </div>
        </div>
      </div>
      } } } }}
    </div>
  </div>
</div>
} @if (fieldResponse) { @for (answer of fieldResponse.answers; track $index) {
@if (answer.question) {
<p>{{ answer.question.form_sub_typ.form_sub_nm }}</p>
<p>{{ answer.question.question }}: {{ answer.value }}</p>
}}}