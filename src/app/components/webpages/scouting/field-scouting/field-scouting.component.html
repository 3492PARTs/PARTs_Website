<app-box [Title]="'Field Scouting Form'">

  <app-form-element-group [LabelText]="'Team results to upload'" *ngIf="outstandingResponses.length > 0">
    <div id="outstanding-results" class="flex align-items-center gap-1rem">
      <app-button [ButtonType]="'refresh'" (FunctionCallBack)="uploadOutstandingResponses()"></app-button>
      <app-button [ButtonType]="'main'" *ngFor="let or of outstandingResponses"
        (FunctionCallBack)="viewResult(or.id)">{{or.team}}</app-button>
    </div>

  </app-form-element-group>
  <br *ngIf="outstandingResponses.length > 0">

  <div id="scout-header">
    <div id="scouts">
      <div class="red">
        <p>{{ scoutFieldSchedule.red_one_id?.first_name }} {{ scoutFieldSchedule.red_one_id?.last_name }}</p>
        <div *ngIf="!scoutFieldResponse.match?.red_one_field_response && scoutFieldResponse.match?.red_one">
          <hr>
          <p>{{scoutFieldResponse.match?.red_one}}</p>
        </div>
      </div>

      <div class="blue">
        <p>{{ scoutFieldSchedule.blue_one_id?.first_name }} {{ scoutFieldSchedule.blue_one_id?.last_name }}</p>
        <div *ngIf="!scoutFieldResponse.match?.blue_one_field_response && scoutFieldResponse.match?.blue_one">
          <hr>
          <p>{{scoutFieldResponse.match?.blue_one}}</p>
        </div>
      </div>

      <div class="red">
        <p>{{ scoutFieldSchedule.red_two_id?.first_name }} {{ scoutFieldSchedule.red_two_id?.last_name }}</p>
        <div *ngIf="!scoutFieldResponse.match?.red_two_field_response && scoutFieldResponse.match?.red_two">
          <hr>
          <p>{{scoutFieldResponse.match?.red_two}}</p>
        </div>
      </div>

      <div class="blue">
        <p>{{ scoutFieldSchedule.blue_two_id?.first_name }} {{ scoutFieldSchedule.blue_two_id?.last_name }}</p>
        <div *ngIf="!scoutFieldResponse.match?.blue_two_field_response && scoutFieldResponse.match?.blue_two">
          <hr>
          <p>{{scoutFieldResponse.match?.blue_two}}</p>
        </div>
      </div>

      <div class="red">
        <p>{{ scoutFieldSchedule.red_three_id?.first_name }} {{ scoutFieldSchedule.red_three_id?.last_name }}</p>
        <div *ngIf="!scoutFieldResponse.match?.red_three_field_response && scoutFieldResponse.match?.red_three">
          <hr>
          <p>{{scoutFieldResponse.match?.red_three}}</p>
        </div>
      </div>

      <div class="blue">
        <p>{{ scoutFieldSchedule.blue_three_id?.first_name }} {{ scoutFieldSchedule.blue_three_id?.last_name }}</p>
        <div *ngIf="!scoutFieldResponse.match?.blue_three_field_response && scoutFieldResponse.match?.blue_three">
          <hr>
          <p>{{scoutFieldResponse.match?.blue_three}}</p>
        </div>
      </div>
    </div>
  </div>
  <br>

  <div id="field-scouting-form">
    <app-form (SubmitFunction)="save()" [FormElements]="formElements">
      <div *ngIf="formDisabled" class="padding-bottom-1rem">
        <app-button [ButtonType]="'warning'" (FunctionCallBack)="reset()">Reset</app-button>
        <app-button [ButtonType]="'danger'" (FunctionCallBack)="removeResult()">Remove Result</app-button>
      </div>

      <div *ngIf="matches.length > 0" class="flex align-items-baseline">
        <app-form-element [LabelText]="'Match'" [Type]="'select'" [SelectList]="matches"
          [DisplayProperty]="'match_number'" [DisplayEmptyOption]="true" [(Model)]="scoutFieldResponse.match"
          [Required]="matches.length > 0 && !noMatch" (FunctionCallBack)="buildTeamList()" [Disabled]="formDisabled"
          [MinWidth]="'100px'">
        </app-form-element>

        <app-button [ButtonType]="'warning'" (FunctionCallBack)="setNoMatch()" [Disabled]="formDisabled">No Match
        </app-button>
      </div>
      <app-form-element [LabelText]="'Team'" [Type]="'select'" [FormGroup]="true" [SelectList]="teams"
        [BindingProperty]="'team_no'" [DisplayProperty]="'team_no'" [DisplayProperty2]="'team_nm'"
        [DisplayEmptyOption]="true" [(Model)]="scoutFieldResponse.team" [Required]="true" [Disabled]="formDisabled"
        [MinWidth]="'100px'">
      </app-form-element>

      @if(activeFormSubTypeForm) {
      <div id="header-wrapper">
        @if(activeFormSubTypeForm && activeFormSubTypeForm?.question_flows &&
        activeFormSubTypeForm.question_flows.length > 0) {
        <app-button #fullScreenButton id="full-screen-btn"
          [ButtonType]="!fullScreen ? 'arrow-expand-all' : 'arrow-collapse-all'"
          (FunctionCallBack)="setFullScreen(!fullScreen)" [BackgroundColor]="'#808080'"></app-button>
        }

        <app-header #formSubTypeHeader [h]="2"
          [Color]="fullScreen ? 'white' : undefined">{{activeFormSubTypeForm.form_sub_typ.form_sub_nm}}
          {{activeFormSubTypeForm.form_sub_typ.form_sub_typ === 'auto' ? (stopwatchSecond.toString().padStart(2, '0') +
          's:'
          + stopwatchLoopCount.toString().padStart(3, '0') +
          'ms')
          : ''}}</app-header>
      </div>
      }

      <div #imageBackground id="image-background" class="flex align-items-center justify-content-center">
        <div #imageContainer id="image-container"
          *ngIf="activeFormSubTypeForm && activeFormSubTypeForm?.question_flows && activeFormSubTypeForm.question_flows.length > 0"
          (click)="stopwatchStart()">

          <img #image id="image" *ngIf="fieldForm.img_url && activeFormSubTypeForm" [src]="fieldForm.img_url">

          <div class="flow" *ngFor="let flow of (activeFormSubTypeForm?.question_flows || [])">
            <div #box class="box" *ngFor="let q of flow.questions; let i = index" id="{{q.question_id}}"
              (click)="advanceFlow(flow, flow.questions[i])">

              <div
                [ngClass]="{'full-width': q.question_typ.question_typ === 'mnt-psh-btn', 'full-height': q.question_typ.question_typ === 'mnt-psh-btn', 'flex': q.question_typ.question_typ !== 'mnt-psh-btn', 'align-items-baseline': q.question_typ.question_typ !== 'mnt-psh-btn'}">
                <app-question-form-element [(Question)]="flow.questions[i]"></app-question-form-element>

                @if (q.question_typ.question_typ !== 'mnt-psh-btn') {
                <app-button [ButtonType]="'check-bold'" (FunctionCallBack)="advanceFlow(flow, flow.questions[i], true)"
                  [BackgroundColor]="'lightgray'"></app-button>
                }
              </div>
            </div>
          </div>
        </div>
      </div>

      <app-question-display-form *ngIf="activeFormSubTypeForm" [(Questions)]="activeFormSubTypeForm.questions" [QuestionAnswers]="scoutFieldResponse.answers"
        (FormElementsChange)="setFormElements($event)" [Disabled]="formDisabled">
      </app-question-display-form>

      <app-button-ribbon>
        <app-button [ButtonType]="'warning'" (FunctionCallBack)="reset(true)">Reset</app-button>

        @if(!activeFormSubTypeForm ||
        (activeFormSubTypeForm.form_sub_typ.form_sub_typ === 'auto' && activeFormSubTypeForm.question_flows.length >
        0)||
        activeFormSubTypeForm.form_sub_typ.form_sub_typ === formSubTypeForms[formSubTypeForms.length -
        1].form_sub_typ.form_sub_typ) {
        <app-button [ButtonType]="'danger'" (FunctionCallBack)="nextFlow()" [Disabled]="true">Next</app-button>
        }
        @else {
        <app-button [ButtonType]="'danger'" (FunctionCallBack)="nextFlow()"
          [Disabled]="!activeFormSubTypeForm || activeFormSubTypeForm.form_sub_typ.form_sub_typ === formSubTypeForms[formSubTypeForms.length - 1].form_sub_typ.form_sub_typ">Next</app-button>
        }

        <app-button [Type]="'submit'" [ButtonType]="'main'"
          [Disabled]="formDisabled ||!activeFormSubTypeForm || activeFormSubTypeForm.form_sub_typ.form_sub_typ !== formSubTypeForms[formSubTypeForms.length - 1].form_sub_typ.form_sub_typ">Save</app-button>
      </app-button-ribbon>

    </app-form>
  </div>
</app-box>